# Backend

## Project Structure

The structure of backend project includes these files 

```
backend/
    manage.py
    backend/
        __init__.py
        settings.py
        urls.py
        wsgi.py
    requirements.txt
    users/
        migrations
        __init__.py
        apps.py
        models.py
        serializers.py
        urls.py
        utils.py
        tests.py
        views.py
    events/
        migrations
        __init__.py
        admin.py
        apps.py
        models.py
        serializers.py
        tests.py
        urls.py
        views.py
```

These files are:
- The outer backend/ root directory is a container for your project. 
- The inner backend/ directory is the actual Python package for this project. Its name is the Python package name you must use when importing anything from it, like backend.urls.
- The inner backend/user directory is the Django app direcotry for managing users.
- `manage.py` is a command-line utility that lets you interact with this Django project in various ways. The detailed could be refered via [https://docs.djangoproject.com/en/2.2/ref/django-admin/](https://docs.djangoproject.com/en/2.2/ref/django-admin/)
- `backend/init.py`: This is an empty file that informs Python that this directory should be recognized as a Python package.
- `backend/settings.py`: This file contains the settings and configuration for your Django project. 
- `backend/urls.py`: This file contains the URL declarations for your Django project, essentially serving as a "table of contents" for your Django-powered site. For further information on URLs, you can consult the URL dispatcher documentation.
- `backend/wsgi.py`: This file serves as an entry point for WSGI-compatible web servers to host your project.
- `requirements.txt`: This file specifies dependencies of the backend project. This file is automatically generated by `pip freeze > requirements.txt` 


## Installation 
Some necessary libraries should be installed as prerequisite if it is still missing on the new server
```
sudo apt-get install libmysqlclient-dev
sudo apt install python3-virtualenv
sudo python -m pip install Pillow
```


To install the necessary libraries for this project from PyPI:
```
virtualenv ~/project-virt
source ~/project-virt/bin/activate
pip3 install -r requirements.txt 
```

## Connecting with Database
`backend/backend/settings.py` is already configured the setting for connecting our Django backend with our mySQL server. Because project is public, so USER and PASSWORD is currently hidden, please type the USER and PASSWORD when making deployment.

```
ALLOWED_HOSTS = [''] # Need to add server IP address

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'dbgathernow',
        'USER': '', # Please type own DB username here
        'PASSWORD': '', # Please type own DB password here
        'HOST': 'dbgathernow.mysql.database.azure.com',
        'PORT': '3306',
    }
}
```

## Migrating Database
If there is any changes for backend code, the database should be migrated. The following commands should be run in the backend directory. 

### Make Migration
```
python3 manage.py makemigrations users
python3 manage.py makemigrations events
```

### Migrate 
```
python3 manage.py migrate users
python3 manage.py migrate events
```

## Run server
To run the server locally, you can use the following command:
```
python manage.py runserver
```
The server will be live on `http://localhost:8000/` or `http://127.0.0.1:8000/`

Run the following commands to start the service on Microsoft Azure. To make the port open on Azure, we need to run 0.0.0.0:8000 to open the port 8000.
```
python manage.py runserver 0.0.0.0:8000
```
The web server will be live on `http://[Server_IP_Address]:8000/`.

## Testing 
Currently, the test for each app is written in `tests.py` in each app directory. Thus, we have
- `backend/users/tests.py` This is the test for user app
- `backend/events/tests.py` This is the test for event app

To run the test, you can use the following command:
```
coverage run manage.py test users events
```

To check the coverage of the test, you can use the following command:
```
coverage report -m
```

When writing the unit test, we should coverage the test at least 90% for each .py file.